name: Tests

on:
  workflow_call:  # Can be called by other workflows

jobs:
  iam:
    name: ðŸ§ª IAM Tests
    runs-on: ubuntu-latest
    env:
      PYTHONPATH: ${{ github.workspace }}/iam/src:${{ github.workspace }}
      SERVER_URL: "http://127.0.0.1:9000"
      KEYCLOAK_FRONTEND_URL: "http://keycloak:9000"
      REALM: "templateRealm"
      CLIENT_ID: "templateApp"
      SCOPE: "openid"
      KC_BOOTSTRAP_ADMIN_USERNAME: "admin"
      KC_BOOTSTRAP_ADMIN_PASSWORD: "admin"
      IAM_PORT: "8081"
      IAM_HOST: "localhost"
      MONGO_CONNECTION_STRING: "mongodb://localhost:27017"
      DB_NAME: "templateApp"
      APP_EMAIL: "admin@example.com"
      APP_PASSWORD: "xxx xxx xxx"
      SYSTEM_ADMIN_USER_NAME: "sysadmin"
      SYSTEM_ADMIN_FIRST_NAME: "None"
      SYSTEM_ADMIN_LAST_NAME: "None"
      SYSTEM_ADMIN_EMAIL: "sysadmin@dev.com"
      SYSTEM_ADMIN_PASSWORD: "sysadminpassword"
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with:
        python-version: '3.12'
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r iam/requirements.txt
        pip install pytest pytest-asyncio mongomock
    - name: Run Tests
      run: pytest iam/test
